<!DOCTYPE html>
<!-- saved from url=(0070)https://zaiste.net/table_inheritance_and_partitioning_with_postgresql/ -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>Table inheritance and partitioning with PostgreSQL · zaiste.net</title>

    
<meta name="viewport" content="width=device-width,initial-scale=1">

<meta name="author" content="Zaiste">
<meta name="description" content="Zaiste is a software technologist. He helps companies build great software products. Expertise in Java Ruby Python JavaScript Node.js Clojure Dart Flutter
">
<meta name="theme-color" content="#475359">

<!-- Open Graph -->
<meta property="og:type" content="article">
<meta property="og:description" content="Zaiste is a software technologist. He helps companies build great software products. Expertise in Java Ruby Python JavaScript Node.js Clojure Dart Flutter
">
<meta property="og:title" content="Table inheritance and partitioning with PostgreSQL · zaiste.net">
<meta property="og:site_name" content="">
<meta property="og:image" content="">
<meta property="og:image:type" content="">
<meta property="og:image:width" content="">
<meta property="og:image:height" content="">
<meta property="og:url" content="https://zaiste.net/table_inheritance_and_partitioning_with_postgresql/">
<meta property="og:locale" content="en_US">

<!-- Twitter Cards -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="">
<meta name="twitter:title" content="Table inheritance and partitioning with PostgreSQL · zaiste.net">
<meta name="twitter:creator" content="">
<meta name="twitter:description" content="Zaiste is a software technologist. He helps companies build great software products. Expertise in Java Ruby Python JavaScript Node.js Clojure Dart Flutter
">
<meta name="twitter:image:src" content="">
<meta name="twitter:domain" content="">

<script type="text/javascript" async="" src="./Table inheritance and partitioning with PostgreSQL · zaiste.net_files/ga.js"></script><script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "Person",
    "name": "Zaiste",
    "jobTitle": "Software Engineer",
    "image": "assets/images/zaiste.jpg",
    "url": "https://zaiste.net",
    "sameAs": [
      "https://instagram.com/zaiste",
      "https://www.linkedin.com/in/zaiste",
      "https://twitter.com/zaiste",
      "https://github.com/zaiste"
    ]
  }
</script>


    <link rel="dns-prefetch" href="https://ssl.google-analytics.com/">
    <link rel="dns-prefetch" href="https://api.eventil.com/">

    <link rel="apple-touch-icon" sizes="180x180" href="https://zaiste.net/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="https://zaiste.net/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://zaiste.net/favicon-16x16.png">
    <link rel="manifest" href="https://zaiste.net/site.webmanifest">

    <link rel="canonical" href="https://zaiste.net/table_inheritance_and_partitioning_with_postgresql/">
    <link rel="stylesheet" href="./Table inheritance and partitioning with PostgreSQL · zaiste.net_files/bootstrap.min.css" crossorigin="anonymous">
    <link href="./Table inheritance and partitioning with PostgreSQL · zaiste.net_files/main.css" rel="stylesheet">
    

    <script>
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', "UA-20458791-1"]);
  _gaq.push(['_setDomainName', "zaiste.net"]);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
  </head>
  <body>
    <nav class="navbar navbar-expand-lg navbar-light">
      <div class="container">
        <a class="navbar-brand" href="https://zaiste.net/">Z</a>

        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav mr-auto">
            <li class="nav-item">
              <a class="nav-link" href="https://zaiste.net/posts/">Blog</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="https://zaiste.net/speaking/">Talks</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="https://zaiste.net/workshops/">Workshops</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="https://zaiste.net/about/">About</a>
            </li>
          </ul>
          <a class="nav-link" href="https://zaiste.net/flutter-in-practice/">Flutter in Practice</a>
          <a class="nav-link" href="https://zaiste.net/doomcasts/">Doomcasts</a>
        </div>
      </div>
    </nav>

    <main class="container">
      
<div class="row">
  <div class="col-md-9">
    <article class="content is-large">
      <h1 class="title">Table inheritance and partitioning with PostgreSQL</h1>

      <div class="subtitle meta">
        <small>2014-07-07 ·</small>
        <div class="tags">
          
          <a class="badge badge-pill badge-light" href="https://zaiste.net/tags/postgresql">postgresql</a>
          
        </div>
      </div>

      

      <p>PostgreSQL supports <a href="http://www.postgresql.org/docs/9.4/static/ddl-inherit.html">table inheritance</a> and <a href="http://www.postgresql.org/docs/9.4/static/ddl-partitioning.html">table partitioning</a>.</p>
<h2 id="inheritance">Inheritance</h2>
<p>Table inheritance allows to extract a common set of columns into a parent,
master table with children defining additional fields.</p>
<pre><code>create table articles (id serial, title varchar, content text);
</code></pre>
<pre><code>create table articles_w_tags (tags text[]) inherits (articles);
</code></pre>
<pre><code>create table articles_wo_tags () inherits (articles);
</code></pre>
<p>Let's insert some data</p>
<pre><code>insert into articles_wo_tags (title, content)
    values ('Title 1', 'Content 1'),
           ('Title 2', 'Content 2');
</code></pre>
<pre><code>insert into articles_w_tags (title, content, tags)
    values ('Title 3', 'Content 3', '{"tag_1", "tag_2"}'::text[]),
           ('Title 4', 'Content 4', '{"tag_2", "tag_3"}'::text[]);
</code></pre>
<p>Let's perform a <code>select</code> query on each of these tables.</p>
<pre><code>select * from articles_wo_tags;
 id |  title  |  content
----+---------+-----------
  1 | Title 1 | Content 1
  2 | Title 2 | Content 2
</code></pre>
<pre><code>select * from articles_w_tags;
 id |  title  |  content  |     tags
----+---------+-----------+---------------
  3 | Title 3 | Content 3 | {tag_1,tag_2}
  4 | Title 4 | Content 4 | {tag_2,tag_3}
</code></pre>
<p>When querying the master table, the query references all rows of that master table
plus all of its children tables; values from the common set of columns are displayed.
The <code>only</code> keyword can be used to indicate that the query should apply only to a
particular table and not any tables below it in the inheritance hierarchy.</p>
<pre><code>select * from articles;
 id |  title  |  content
----+---------+-----------
  3 | Title 3 | Content 3
  4 | Title 4 | Content 4
  1 | Title 1 | Content 1
  2 | Title 2 | Content 2
</code></pre>
<p>Changes performed on the master table are propagated to the children.</p>
<pre><code>update articles set content = content || ' Changed';
</code></pre>
<pre><code>select * from articles_w_tags;
 id |  title  |      content      |     tags
----+---------+-------------------+---------------
  3 | Title 3 | Content 3 Changed | {tag_1,tag_2}
  4 | Title 4 | Content 4 Changed | {tag_2,tag_3}
</code></pre>
<h2 id="partitioning">Partitioning</h2>
<p>Table partitioning means splitting a table into smaller pieces and provides
various performance benefits for tables that hold large amounts of data, i.e.
the size of a table is about to exceed the physical memory of the database
server.</p>
<p>PostgreSQL allows table partitioning via table inheritance. Each partition must
be created as a child table of a single parent table (which remains empty and
exists only to represent the whole data set).</p>
<p>PostgreSQL implements <strong>range</strong> and <strong>list</strong> partitioning methods. The former is
done with a range defined by a column or set of columns with no overlap between
the ranges. The latter is done by explicitly listing which key values appear in
each partition.</p>
<p>Let's start by creating a parent table called <code>logs</code>.</p>
<pre><code>create table logs (created_at timestamp without time zone default now(),
                   content text);
</code></pre>
<p>We will partition table by date into four quarters of the year.</p>
<pre><code>create table logs_q1
    (check (created_at &gt;= date '2014-01-01' and created_at &lt;= date '2014-03-31'))
    inherits (logs);
</code></pre>
<pre><code>create table logs_q2
    (check (created_at &gt;= date '2014-04-01' and created_at &lt;= date '2014-06-30'))
    inherits (logs);
</code></pre>
<pre><code>create table logs_q3
    (check (created_at &gt;= date '2014-07-01' and created_at &lt;= date '2014-09-30'))
    inherits (logs);
</code></pre>
<pre><code>create table logs_q4
    (check (created_at &gt;= date '2014-10-01' and created_at &lt;= date '2014-12-31'))
    inherits (logs);
</code></pre>
<p>Next step is to create indices on the key column of each child table.</p>
<pre><code>create index logs_q1_created_at on logs_q1 using btree (created_at);
create index logs_q2_created_at on logs_q2 using btree (created_at);
create index logs_q3_created_at on logs_q3 using btree (created_at);
create index logs_q4_created_at on logs_q4 using btree (created_at);
</code></pre>
<p>Next, let's create a trigger function to dispatch the data among child tables.</p>
<pre><code>create or replace function on_logs_insert() returns trigger as $$
begin
    if ( new.created_at &gt;= date '2014-01-01' and new.created_at &lt;= date '2014-03-31') then
        insert into logs_q1 values (new.*);
    elsif ( new.created_at &gt;= date '2014-04-01' and new.created_at &lt;= date '2014-06-30') then
        insert into logs_q2 values (new.*);
    elsif ( new.created_at &gt;= date '2014-07-01' and new.created_at &lt;= date '2014-09-30') then
        insert into logs_q3 values (new.*);
    elsif ( new.created_at &gt;= date '2014-10-01' and new.created_at &lt;= date '2014-12-31') then
        insert into logs_q4 values (new.*);
    else
        raise exception 'created_at date out of range';
    end if;

    return null;
end;
$$ language plpgsql;
</code></pre>
<p>Let's attach the trigger function defined above to <code>logs</code> table.</p>
<pre><code>create trigger logs_insert
    before insert on logs
    for each row execute procedure on_logs_insert();
</code></pre>
<p>Finally, let's insert some data into <code>logs</code> table to see the partitioning in
work.</p>
<pre><code>insert into logs (created_at, content)
    values (date '2014-02-03', 'Content 1'),
           (date '2014-03-11', 'Content 2'),
           (date '2014-04-13', 'Content 3'),
           (date '2014-07-08', 'Content 4'),
           (date '2014-10-23', 'Content 5');
</code></pre>
<pre><code>select * from logs_q1;
     created_at      |  content
---------------------+-----------
 2014-02-03 00:00:00 | Content 1
 2014-03-11 00:00:00 | Content 2
</code></pre>
<pre><code>select * from logs_q2;
     created_at      |  content
---------------------+-----------
 2014-04-13 00:00:00 | Content 3
</code></pre>
<pre><code>select * from logs_q3;
     created_at      |  content
---------------------+-----------
 2014-07-08 00:00:00 | Content 4
</code></pre>
<pre><code>select * from logs_q4;
     created_at      |  content
---------------------+-----------
 2014-10-23 00:00:00 | Content 5
</code></pre>
<p>A short article that dive a bit more in <a href="http://www.opensourceforu.com/2012/01/partitioning-in-postgresql/">partitioning in PostgreSQL</a></p>

    </article>
  </div>
  <div class="col-md-3">
    <aside class="menu">
      <p class="menu-label">
        Table of Contents
      </p>
      <li class="toc-item"><a href="https://zaiste.net/table_inheritance_and_partitioning_with_postgresql/#inheritance" class="toc-link">Inheritance</a></li><li class="toc-item"><a href="https://zaiste.net/table_inheritance_and_partitioning_with_postgresql/#partitioning" class="toc-link">Partitioning</a></li>
    </aside>
  </div>
</div>

    </main>

    <footer class="footer">
      <div class="container">
        <div class="row">
          <div class="col-md-6">
            <h3>Zaiste</h3>
            <p>I'm a programmer, a technology consultant and <a href="https://nukomeet.com/">Nukomeet</a> co-founder. I've also founded <a href="https://rupy.eu/">RuPy Conf</a> and <a href="https://polyconf.com/">PolyConf</a> which advocate polyglot programming and bring different programming languages and communities together. I'm building an event management platform for tech people at <a href="https://eventil.com/">Eventil</a>.</p>
          </div>
          <div class="col-md-1">
          </div>
          <div class="col-md-1">
          </div>
          <div class="col-md-2">
            <ul class="list-unstyled">
              <li><h3>Zaiste</h3></li>
              <li><a href="https://zaiste.net/about/">About</a></li>
              <li><a href="https://zaiste.net/speaking/">Speaking</a></li>
              <li><a href="https://zaiste.net/workshops/">Workshops</a></li>
            </ul>
          </div>
          <div class="col-md-2">
            <ul class="list-unstyled">
              <li><h3>Open Source</h3></li>
              <li><a href="https://huncwot.org/">Huncwot</a></li>
              <li><a href="https://kulfon.net/">Kulfon</a></li>
            </ul>
          </div>
        </div>
      </div>
    </footer>
    <div class="bottom">
      <div class="container">
        Copyright © 2019 All rights reserved.

        <div class="is-pulled-right">Powered by <a href="https://kulfon.net/">Kulfon</a>.</div>

      </div>
    </div>

    <script defer="" src="./Table inheritance and partitioning with PostgreSQL · zaiste.net_files/saved_resource"></script>
    <script defer="" type="text/javascript" src="./Table inheritance and partitioning with PostgreSQL · zaiste.net_files/main.ea51b65705aa0ee12a27dd306d25f7e506d122e8.js"></script>
  

</body></html>