<!DOCTYPE html>
<!-- saved from url=(0080)https://www.postgresql.org/message-id/E16lBjr-00033N-00@hall.mail.mindspring.net -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>PostgreSQL: Re: Storing Credit Card Info?</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
   
  <meta name="theme-color" content="#336791">
  <meta name="copyright" content="The PostgreSQL Global Development Group">
  <link href="./PostgreSQL_ Re_ Storing Credit Card Info__files/fontawesome.css" rel="stylesheet">
  <link rel="stylesheet" href="./PostgreSQL_ Re_ Storing Credit Card Info__files/bootstrap.min.css">
  <link rel="shortcut icon" href="https://www.postgresql.org/favicon.ico">
  
  <link rel="stylesheet" type="text/css" href="./PostgreSQL_ Re_ Storing Credit Card Info__files/base.css">
  
  </head>
  <body>
    <div class="container-fluid">
      <div class="row justify-content-md-center">
        <div class="col">
          <!-- Header -->
          <nav class="navbar navbar-expand-lg navbar-light bg-light">
            <a class="navbar-brand p-0" href="https://www.postgresql.org/">
              <img class="logo" src="./PostgreSQL_ Re_ Storing Credit Card Info__files/elephant.png" alt="PostgreSQL Elephant Logo">
            </a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#pgNavbar" aria-controls="pgNavbar" aria-expanded="false" aria-label="Toggle navigation">
              <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="pgNavbar">
              <ul class="navbar-nav mr-auto">
                <li class="nav-item p-2"><a href="https://www.postgresql.org/" title="Home">Home</a></li>
                <li class="nav-item p-2"><a href="https://www.postgresql.org/about/" title="About">About</a></li>
                <li class="nav-item p-2"><a href="https://www.postgresql.org/download/" title="Download">Download</a></li>
                <li class="nav-item p-2"><a href="https://www.postgresql.org/docs/" title="Documentation">Documentation</a></li>
                <li class="nav-item p-2"><a href="https://www.postgresql.org/community/" title="Community">Community</a></li>
                <li class="nav-item p-2"><a href="https://www.postgresql.org/developer/" title="Developers">Developers</a></li>
                <li class="nav-item p-2"><a href="https://www.postgresql.org/support/" title="Support">Support</a></li>
                <li class="nav-item p-2"><a href="https://www.postgresql.org/about/donate/" title="Donate">Donate</a></li>
                <li class="nav-item p-2"><a href="https://www.postgresql.org/account/" title="Your account">Your account</a></li>
              </ul>
             <form role="search" method="get" action="https://www.postgresql.org/search/">
               <div class="input-group">
                 <input id="q" name="q" type="text" size="20" maxlength="255" accesskey="s" class="form-control" placeholder="Search for...">
                 <span class="input-group-btn">
                   <button class="btn btn-default" type="submit"><i class="fas fa-search"></i></button>
                 </span>
               </div><!-- /input-group -->
             </form>
            </div>
          </nav>
        </div>
      </div>
      
    </div>
    
<div class="container-fluid margin archive">
  <div class="row">
    <div class="col-lg-2">
      <div id="pgSideWrap">
       <div id="pgSideNav">
         <h2>Quick Links</h2>
         <ul>
            <li><a href="https://www.postgresql.org/community/">Community</a></li>
            <li><a href="https://www.postgresql.org/community/contributors/">Contributors</a></li>
            <li><a href="https://www.postgresql.org/list/">Mailing Lists</a></li>
            <li><a href="https://www.postgresql.org/community/irc/">IRC</a></li>
            <li><a href="https://postgres-slack.herokuapp.com/">Slack</a></li>
            <li><a href="https://www.postgresql.org/community/user-groups/">Local User Groups</a></li>
            <li><a href="https://www.postgresql.org/about/events/">Events</a></li>
            <li class="last-child"><a href="https://www.postgresql.org/community/international/">International Sites</a></li>
         </ul>
       </div>
      </div> <!-- pgSideWrap -->
    </div>
    <div class="col-lg-10">
      <div id="pgContentWrap">
        

<h1 class="subject">Re: Storing Credit Card Info?</h1>



<table class="table-sm table-responsive message-header" style="border-bottom: 0.05em solid #E7EAE8; margin-bottom: 1em;">
 <tbody><tr>
  <th scope="row" style="width: 10%">From:</th>
  <td>"Greg Sabino Mullane" &lt;greg(at)turnstep(dot)com&gt;</td>
 </tr>
 <tr>
  <th scope="row">To:</th>
  <td>pgsql-general(at)postgresql(dot)org</td>
 </tr>

 <tr>
  <th scope="row">Subject:</th>
  <td>Re: Storing Credit Card Info?</td>
 </tr>
 <tr>
  <th scope="row">Date:</th>
  <td>2002-03-13 16:40:41</td>
 </tr>
 <tr>
  <th scope="row">Message-ID:</th>
  <td><a href="https://www.postgresql.org/message-id/E16lBjr-00033N-00%40hall.mail.mindspring.net">E16lBjr-00033N-00@hall.mail.mindspring.net</a></td>
 </tr>
 <tr>
   <th class="align-middle" scope="row">Views:</th>
   <td>
     <a href="https://www.postgresql.org/message-id/raw/E16lBjr-00033N-00%40hall.mail.mindspring.net">Raw Message</a> |
     <a href="https://www.postgresql.org/message-id/flat/E16lBjr-00033N-00%40hall.mail.mindspring.net">Whole Thread</a> |
     <a href="https://www.postgresql.org/message-id/mbox/E16lBjr-00033N-00%40hall.mail.mindspring.net">Download mbox</a>
   </td>
 </tr>
 
   <tr>
    <th class="align-middle" scope="row">Thread:</th>
    <td>
     <select id="thread_select" class="custom-select">
  <option value="E16lBjr-00033N-00%40hall.mail.mindspring.net" selected="selected">2002-03-13 16:40:41 from "Greg Sabino Mullane" &lt;greg(at)turnstep(dot)com&gt;</option>
  <option value="20020321234020.79c852f9.jfh%40cise.ufl.edu">&nbsp;2002-03-22 04:40:20 from James F(dot)Hranicky &lt;jfh(at)cise(dot)ufl(dot)edu&gt;</option>
  
     </select>
    </td>
   </tr>
  
  
    <tr>
      <th scope="row">Lists:</th>
      <td>
        
          <span class="listname"><a href="https://www.postgresql.org/list/pgsql-general/since/200203131640">pgsql-general</a></span>
        
      </td>
    </tr>
  
</tbody></table>

<div class="message-content"><p><br>-----BEGIN PGP SIGNED MESSAGE-----<br>Hash: SHA1</p>

<p>&gt; ...storing credit card info in a database.<br>&gt; <br>&gt; Obviously, storing them in the clear is right out.  Do folks hash them<br>&gt; with MD5?  Require a password?  If so, is there just one for all<br>&gt; the credit cards?  A separate one for each?<br>&gt; <br>&gt; Big TIA for any hints, tips or pointers :)</p>

<p>A lot depends on exactly how you are going to use the information, but <br>the most important thing is not so much how to store the information but <br>how to restrict access to the database. The machine holding the database <br>should be well-isolated from other machines, and definitely not publicly <br>accessible. Making a hash would be good, except that a hash is one-way and <br>I am assuming you want to actually be able to extract the information <br>again. :) Basically, you need to defend against:</p>

<p>* Somebody breaking into the box that the database is on.</p>

<p>* Somebody breaking into the database that has the credit card numbers.</p>

<p>* Somebody breaking into the application box that does the actual work.</p>

<p>* Somebody sniffing the traffic between the two.</p>

<p>A secure connection (i.e. ssh, SSL) will take care of the last problem <br>above. Normal user permissions and basic security procedures take <br>care of the first one.</p>

<p>As far as someone with access to the database, you should encrypt the <br>credit card numbers, **without storing the decryption key in the <br>database or even on the same box**. This is fairly easy- the hard part is <br>securing the application box, because if someone manages to break into that, <br>it can be very hard for the database to distinguish legitimate requests from <br>false requests from someone who has broken in and is fishing for credit <br>card information.</p>

<p>(For this whole scenario, I am envisioning a web-based application that <br>remembers customer's credit card information for quick-n-easy ordering <br>of goods at a later time.. Your mileage may vary.)</p>

<p>A simple way to do this is to have the application be responsible <br>for encrypting and decrypting the information, and the database responsible <br>for storing it. This protects against somebody breaking into the database <br>server. </p>

<p>However, it fails to protect against someone breaking into the application <br>box and getting the encryption key and/or reading credit card numbers after <br>they are decrypted. Unfortunately, there is no simple way to defend against <br>this, besides the obvious securing of the box, because at some point the <br>application will need the credit card information "in the clear." You can <br>booby trap the box with tripwire and the like, as well as add some <br>rate-limiting and logic checks to the database box. For example, <br>equally spaced orders and/or alphabetically sorted users should sound an <br>alarm and halt the passing of information until someone manually <br>resets things. You could also set up some traps on the application side <br>that may catch the unwary intruder, such as deeply buried code that <br>adds an underscore to every username sent to the database box. A lack <br>of underscore would cause the database to slam shut instantly.</p>

<p>A better way is to have a third box (ordering) that is responsible for <br>actually placing orders. This way, someone breaking into the application <br>can only place false orders, but they cannot get at the credit card <br>information. Breaking into any two boxes will not get all the credit <br>card information either - they would have to break into all three.</p>

<p>*** Breakdown of a three box system:</p>

<p>** New customer:</p>

<p>* Customer enters information into web browser, send it to the the <br>  application box. Application box encrypts the information (unique key) <br>  and sends it to the ordering box, along with the decryption phrase, <br>  and the order details. It may even encrypt the passphrase so that only <br>  the ordering box can read it.</p>

<p>* The ordering box temporarily decrypts the information to place the order. <br>  If the customer wants their information saved, the ordering box encrypts <br>  the original message with it's own unique-per-user key, sends the <br>  doubly-encrypted information to the database box, and erases everything <br>  else.</p>

<p>** Returning customer:</p>

<p>* Customer places an order via the web browser, and sends it to the <br>  application box. The application box looks up the decryption <br>  phrase for that user, and sends the order information, the username, <br>  and the passphrase to the ordering box.<br>* The ordering box requests the information for that user from the <br>  database box. The database box sends it over.<br>* The ordering box decrypts it once with the key it has, and again <br>  with the passphrase it received. It places the order, deletes <br>  the information, and sends back a confirmation to the application <br>  box.</p>

<p>So the final answer to your question is: two separate passwords <br>for each credit card. Have fun and remember that all this complexity is <br>always worth it when it comes to protecting your customer's credit cards.</p>

<p>Greg Sabino Mullane greg(at)turnstep(dot)com<br>Will consult for $$$<br>PGP Key: 0x14964AC8 200203131014</p>

<p>-----BEGIN PGP SIGNATURE-----<br>Comment: <a href="http://www.turnstep.com/pgp.html" rel="nofollow">http://www.turnstep.com/pgp.html</a></p>

<p>iD8DBQE8j4D8vJuQZxSWSsgRAjN0AKD5fpFHNfoSgoNDkLjezl4Tk1mL4wCePWFF<br>FxBiy+z6b95v+sI7/AYlqL8=<br>=a52K<br>-----END PGP SIGNATURE-----</p>

<p></p></div>






  <h3 class="messages" style="margin: 0.5em 0;">Responses</h3>
  <ul>
    
      <li class="message-responses">
        <a href="https://www.postgresql.org/message-id/20020321234020.79c852f9.jfh%40cise.ufl.edu">Re: Storing Credit Card Info?</a> at 2002-03-22 04:40:20 from James F.Hranicky
      </li>
    
  </ul>



  
    <h3 class="messages" style="margin: 0.5em 0;">Browse pgsql-general by date</h3>
    <table class="table table-sm table-responsive message-nav">
      <thead>
        <tr>
          <th scope="col">&nbsp;</th>
          <th scope="col">From</th>
          <th scope="col">Date</th>
          <th scope="col">Subject</th>
        </tr>
      </thead>
      <tbody>
        
          <tr>
            <th scope="row"><a href="https://www.postgresql.org/message-id/200203131640.g2DGekVc005645%40www1.translationforge">Next Message</a></th>
            <td>Jean-Michel POURE</td>
            <td>2002-03-13 16:40:46</td>
            <td><a href="https://www.postgresql.org/message-id/200203131640.g2DGekVc005645%40www1.translationforge">Re: Export a database or a table from a database</a></td>
          </tr>
        
        
          <tr>
            <th scope="row"><a href="https://www.postgresql.org/message-id/200203131639.g2DGdeVc005635%40www1.translationforge">Previous Message</a></th>
            <td>Jean-Michel POURE</td>
            <td>2002-03-13 16:39:40</td>
            <td><a href="https://www.postgresql.org/message-id/200203131639.g2DGdeVc005635%40www1.translationforge">Re: Stored procedure in PostgreSQL</a></td>
          </tr>
        
      </tbody>
    </table>
  





      </div> <!-- pgContentWrap -->
    </div>
  </div>
</div>

    <!-- Footer -->
    <footer id="footer">
      <div class="container">
        <div class="row">
          <div class="col-md-12">
            <ul>
              <li><a href="https://twitter.com/postgresql"><img src="./PostgreSQL_ Re_ Storing Credit Card Info__files/atpostgresql.png" alt="@postgresql"></a></li>
              <li><a href="https://git.postgresql.org/gitweb/?p=postgresql.git"><img src="./PostgreSQL_ Re_ Storing Credit Card Info__files/git.png" alt="Git"></a></li>
            </ul>
          </div>
        </div>
      </div>
      <!-- Copyright -->
      <div class="container">
        <a href="https://www.postgresql.org/about/privacypolicy">Privacy Policy</a> |
        <a href="https://www.postgresql.org/about/policies/coc/">Code of Conduct</a> |
        <a href="https://www.postgresql.org/about/">About PostgreSQL</a> |
        <a href="https://www.postgresql.org/about/contact/">Contact</a><br>
        <p>Copyright © 1996-2019 The PostgreSQL Global Development Group</p>
      </div>
    </footer>
    <script type="text/javascript" async="" src="./PostgreSQL_ Re_ Storing Credit Card Info__files/ga.js"></script><script src="./PostgreSQL_ Re_ Storing Credit Card Info__files/jquery-3.2.1.slim.min.js"></script>
    <script src="./PostgreSQL_ Re_ Storing Credit Card Info__files/popper.min.js"></script>
    <script src="./PostgreSQL_ Re_ Storing Credit Card Info__files/bootstrap.min.js"></script>
    <script src="./PostgreSQL_ Re_ Storing Credit Card Info__files/main.js"></script>
  

</body></html>